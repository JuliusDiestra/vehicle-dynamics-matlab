function [dotX,A,B] = semitrailerLinear(X,U,params)
%SEMITRAILERLINEAR Linear state-space equation of semi-trailer dynamics. Linearize around (X0,U0) = (0,0)
%    [DOTX,A,B] = SEMITRAILERLINEAR(X,U,PARAMS)
%   Inputs:
%       X       : State vector = [vx1 vy1 d_psi1 d_deltaPsi1 psi1 deltaPsi1]
%                   vx1         : Car longitudinal velocity [m/s]
%                   vy1         : Car lateral velocity [m/s]
%                   d_psi1      : Inclination angle rate of Unit 1 w.r.t x-axis of Frame {E}. Unit: [rad/s]
%                   d_deltaPsi1 : Angle rate between Unit 1 and Unit 2. Unit: [rad/s]
%                   psi1        : Inclination angle rate of Unit 1 w.r.t x-axis of Frame {E}. Unit: [rad/s]
%                   deltaPsi1   : Angle rate between Unit 1 and Unit 2. Unit: [rad]
%                      
%       U       : Input vector = [delta11 Fxw12]'
%                   delta11     : Steering-angle. Unit: [rad]
%                   Fxw12       : Longitudinal Force applied on car unit 1 axle 2. Unit: [N]
%       params  : Parameters = [Cy11 Cy12 Cy13 Cy21 Cy22 Cy23 l11 l12 l13 l21 l22 l23 l1c1 l2c1 m1 m2 J1 J2]'
%                   Cyjk        : Cornering stiffness of unit j wheel k. Unit: [N]                  
%                   ljk         : Distance between unit j axle k to Center of gravity of unit j. Unit: [m]                      
%                   ljck        : Distance between Center of Gravity of unit j to joint of unit k. Unit: [m]
%                   mj          : Mass of vehicle unit j
%                   Jj          : Inertia around z-axis of vehicle unit j. Unit: [Kg.m^2]
%   Outputs:
%       dotX    : Symbolic expression of dotX = dX/dt = [d_vx d_vy dd_psi]
%       A       : Matrix from linear expression dX/dt = A*X + B*U
%       B       : Matrix from linear expression dX/dt = A*X + B*U
%   Author : Julius D.



%    This function was generated by the Symbolic Math Toolbox version 8.5.
%    08-Aug-2020 11:16:31

Cy11 = params(:,1);
Cy12 = params(:,2);
Cy13 = params(:,3);
Cy21 = params(:,4);
Cy22 = params(:,5);
Cy23 = params(:,6);
Fxw12 = U(:,2);
J1 = params(:,17);
J2 = params(:,18);
d_deltaPsi1 = X(:,4);
d_psi1 = X(:,3);
delta11 = U(:,1);
psi1 = X(:,5);
deltaPsi1 = X(:,6);
l11 = params(:,7);
l12 = params(:,8);
l13 = params(:,9);
l21 = params(:,10);
l22 = params(:,11);
l23 = params(:,12);
l1c1 = params(:,13);
l2c1 = params(:,14);
m1 = params(:,15);
m2 = params(:,16);
vx1 = X(:,1);
vy1 = X(:,2);
t2 = Cy11.*l11;
t3 = Cy12.*l12;
t4 = Cy13.*l13;
t5 = Cy21.*l21;
t6 = Cy22.*l22;
t7 = Cy23.*l23;
t8 = Cy21.*l1c1;
t9 = Cy22.*l1c1;
t10 = Cy23.*l1c1;
t11 = Cy21.*l2c1;
t12 = Cy22.*l2c1;
t13 = Cy23.*l2c1;
t14 = J2.*l1c1;
t15 = J1.*l2c1;
t16 = J1.*m1;
t17 = J1.*m2;
t18 = J2.*m1;
t19 = J2.*m2;
t20 = m1+m2;
t21 = l11.^2;
t22 = l12.^2;
t23 = l13.^2;
t24 = l21.^2;
t25 = l22.^2;
t26 = l23.^2;
t27 = l1c1.^2;
t28 = l2c1.^2;
t29 = vx1.^2;
t30 = Cy21.*J2;
t31 = Cy22.*J2;
t32 = Cy23.*J2;
t51 = l22+l1c1+l2c1;
t52 = l23+l1c1+l2c1;
t53 = -l21;
t54 = 1.0./vx1;
t57 = l1c1.*l2c1.*m1.*m2;
t33 = J2.*t5;
t34 = J2.*t6;
t35 = J2.*t7;
t36 = J2.*t11;
t37 = J2.*t12;
t38 = J2.*t13;
t39 = J2.*t16;
t40 = J2.*t17;
t41 = l1c1.*t5;
t42 = l1c1.*t6;
t43 = l1c1.*t7;
t44 = l2c1.*t8;
t45 = l2c1.*t9;
t46 = l2c1.*t10;
t47 = l11.*t18;
t48 = l11.*t19;
t49 = m2.*t14;
t50 = m2.*t15;
t55 = -t2;
t56 = -t5;
t58 = -t15;
t59 = l21.*t5;
t60 = l22.*t6;
t61 = l23.*t7;
t62 = l2c1.*t11;
t63 = l2c1.*t12;
t64 = l2c1.*t13;
t65 = l2c1.*t5.*2.0;
t66 = l2c1.*t6.*2.0;
t67 = l2c1.*t7.*2.0;
t68 = t2.*t18;
t69 = t2.*t19;
t70 = t3.*t18;
t71 = t3.*t19;
t72 = t4.*t18;
t73 = t4.*t19;
t74 = t5.*t16;
t75 = t5.*t17;
t76 = t6.*t16;
t77 = t6.*t17;
t78 = t7.*t16;
t79 = t7.*t17;
t84 = t8.*t18;
t86 = t9.*t18;
t88 = t10.*t18;
t89 = t11.*t16;
t90 = t12.*t16;
t91 = t13.*t16;
t92 = l2c1.*m2.*t5;
t93 = l2c1.*m2.*t6;
t94 = l2c1.*m2.*t7;
t95 = t51.^2;
t96 = t52.^2;
t97 = m1.*m2.*t27;
t98 = m1.*m2.*t28;
t99 = t57.*2.0;
t103 = m1.*t5.*t14;
t104 = m1.*t6.*t14;
t105 = m1.*t7.*t14;
t119 = l11.*t57;
t121 = 1.0./t20;
t122 = l1c1+l2c1+t53;
t129 = m1.*t11.*t15;
t130 = m1.*t12.*t15;
t131 = m1.*t13.*t15;
t132 = m1.*t5.*t15.*2.0;
t133 = m1.*t6.*t15.*2.0;
t134 = m1.*t7.*t15.*2.0;
t135 = m2.*t5.*t28;
t137 = m2.*t6.*t28;
t139 = m2.*t7.*t28;
t144 = t2.*t57;
t145 = t3.*t57;
t146 = t4.*t57;
t188 = l11.*t2.*t54;
t189 = l12.*t3.*t54;
t190 = l13.*t4.*t54;
t80 = Cy11.*t49;
t81 = Cy12.*t49;
t82 = Cy13.*t49;
t83 = Cy11.*t50;
t85 = Cy12.*t50;
t87 = Cy13.*t50;
t100 = t2.*t49;
t101 = t3.*t49;
t102 = t4.*t49;
t106 = t5.*t50;
t107 = t6.*t50;
t108 = t7.*t50;
t109 = t18.*t44;
t110 = t18.*t45;
t111 = t18.*t46;
t112 = -t34;
t113 = -t35;
t114 = -t36;
t115 = -t37;
t116 = -t38;
t117 = -t41;
t118 = -t65;
t120 = -t50;
t123 = t16.*t59;
t124 = t17.*t59;
t125 = t16.*t60;
t126 = t17.*t60;
t127 = t16.*t61;
t128 = t17.*t61;
t136 = l2c1.*m2.*t59;
t138 = l2c1.*m2.*t60;
t140 = l2c1.*m2.*t61;
t141 = l1c1.*m1.*t49;
t142 = l2c1.*m1.*t50;
t143 = l11.*t98;
t147 = l2c1.*m1.*m2.*t41;
t148 = l2c1.*m1.*m2.*t42;
t149 = l2c1.*m1.*m2.*t43;
t150 = -t70;
t151 = -t71;
t152 = -t72;
t153 = -t73;
t154 = t16.*t56;
t155 = t17.*t56;
t157 = -t84;
t159 = -t86;
t161 = -t88;
t162 = -t93;
t163 = -t94;
t166 = -t104;
t167 = -t105;
t168 = -t132;
t169 = t50.*t56;
t173 = t2.*t98;
t174 = t3.*t98;
t175 = t4.*t98;
t176 = t5.*t97;
t177 = t6.*t97;
t178 = t7.*t97;
t179 = t41.*t98;
t180 = m1.*t27.*t92;
t182 = t42.*t98;
t183 = m1.*t27.*t93;
t185 = t43.*t98;
t186 = m1.*t27.*t94;
t191 = m2.*t28.*t56;
t192 = t122.^2;
t193 = t14+t58;
t194 = -t145;
t195 = -t146;
t197 = t59.*t97;
t198 = t60.*t97;
t199 = t61.*t97;
t202 = t56.*t97;
t205 = Cy22.*t54.*t95;
t206 = Cy23.*t54.*t96;
t208 = t18+t19+t57+t98;
t212 = t16+t17+t18+t19+t97+t98+t99;
t214 = t3+t4+t6+t7+t8+t9+t10+t11+t12+t13+t55+t56;
t156 = -t83;
t158 = -t85;
t160 = -t87;
t164 = -t101;
t165 = -t102;
t170 = -t109;
t171 = -t110;
t172 = -t111;
t181 = l21.*t147;
t184 = l22.*t148;
t187 = l23.*t149;
t196 = l2c1.*m1.*m2.*t117;
t200 = -t174;
t201 = -t175;
t203 = t98.*t117;
t204 = l2c1.*t202;
t207 = Cy21.*t54.*t192;
t209 = t39+t40+t141+t142;
t211 = t30+t31+t32+t92+t162+t163;
t213 = t47+t48+t49+t119+t120+t143;
t216 = t42+t43+t44+t45+t46+t59+t60+t61+t62+t63+t64+t66+t67+t117+t118;
t217 = t33+t112+t113+t114+t115+t116+t136+t137+t138+t139+t140+t191;
t210 = 1.0./t209;
t215 = t188+t189+t190+t205+t206+t207;
t221 = t76+t77+t78+t79+t89+t90+t91+t148+t149+t154+t155+t157+t159+t161+t177+t178+t196+t202;
t224 = t103+t107+t108+t123+t124+t125+t126+t127+t128+t129+t130+t131+t133+t134+t166+t167+t168+t169+t170+t171+t172+t181+t182+t183+t184+t185+t186+t187+t197+t198+t199+t203+t204;
t218 = m2.*t54.*t193.*t210.*t214;
t219 = t208.*t210.*t215;
t222 = t54.*t210.*t212.*t216;
t223 = t68+t69+t80+t81+t82+t144+t150+t151+t152+t153+t156+t158+t160+t173+t194+t195+t200+t201+t221;
t220 = -t219;
t225 = t218+t220+t222;
dotX = [Fxw12.*t121;-t54.*t210.*(t100.*vy1+t106.*vy1-t107.*vy1-t108.*vy1+t164.*vy1+t165.*vy1-J1.*d_deltaPsi1.*t33+J1.*d_deltaPsi1.*t34+J1.*d_deltaPsi1.*t35+J1.*d_deltaPsi1.*t36+J1.*d_deltaPsi1.*t37+J1.*d_deltaPsi1.*t38+J1.*d_psi1.*t33+J1.*d_psi1.*t112+J1.*d_psi1.*t113+J1.*d_psi1.*t114+J1.*d_psi1.*t115+J1.*d_psi1.*t116+J1.*t30.*vy1+J1.*t31.*vy1+J1.*t32.*vy1+d_psi1.*l11.*t100+d_psi1.*l12.*t101+d_psi1.*l13.*t102+d_deltaPsi1.*l2c1.*t106-d_deltaPsi1.*l2c1.*t107-d_deltaPsi1.*l2c1.*t108+d_psi1.*l1c1.*t100+d_psi1.*l2c1.*t107+d_psi1.*l2c1.*t108+d_psi1.*l1c1.*t164+d_psi1.*l1c1.*t165+d_psi1.*l2c1.*t169+d_deltaPsi1.*t53.*t106+d_deltaPsi1.*t60.*t120+d_deltaPsi1.*t61.*t120+d_psi1.*t29.*t39+d_psi1.*t29.*t40+d_psi1.*t42.*t50+d_psi1.*t43.*t50+d_psi1.*t50.*t59+d_psi1.*t50.*t60+d_psi1.*t50.*t61+d_psi1.*t50.*t117+d_psi1.*t29.*t141+d_psi1.*t29.*t142+deltaPsi1.*t106.*vx1-deltaPsi1.*t107.*vx1-deltaPsi1.*t108.*vx1+l1c1.*t80.*vy1+l1c1.*t81.*vy1+l1c1.*t82.*vy1+l2c1.*t83.*vy1+l2c1.*t85.*vy1+l2c1.*t87.*vy1+d_psi1.*l2c1.*t2.*t50+d_psi1.*l2c1.*t3.*t120+d_psi1.*l2c1.*t4.*t120-delta11.*l1c1.*t80.*vx1+delta11.*l2c1.*t156.*vx1+delta11.*t49.*t55.*vx1+Cy11.*J1.*J2.*vy1+Cy12.*J1.*J2.*vy1+Cy13.*J1.*J2.*vy1+J1.*J2.*d_psi1.*t2-J1.*J2.*d_psi1.*t3-J1.*J2.*d_psi1.*t4-J1.*J2.*d_psi1.*t8-J1.*J2.*d_psi1.*t9-J1.*J2.*d_psi1.*t10+J1.*deltaPsi1.*t30.*vx1+J1.*deltaPsi1.*t31.*vx1+J1.*deltaPsi1.*t32.*vx1-Cy11.*J1.*J2.*delta11.*vx1);-t54.*t210.*(d_deltaPsi1.*t103+d_deltaPsi1.*t166+d_deltaPsi1.*t167+d_deltaPsi1.*t170+d_deltaPsi1.*t171+d_deltaPsi1.*t172+d_deltaPsi1.*t181+d_deltaPsi1.*t182+d_deltaPsi1.*t184+d_deltaPsi1.*t185+d_deltaPsi1.*t187+d_deltaPsi1.*t203+d_psi1.*t100+d_psi1.*t104+d_psi1.*t105+d_psi1.*t109+d_psi1.*t110+d_psi1.*t111+d_psi1.*t164+d_psi1.*t165+d_psi1.*t179+d_psi1.*t180-d_psi1.*t182-d_psi1.*t184-d_psi1.*t185-d_psi1.*t187+t68.*vy1+t69.*vy1+t80.*vy1+t81.*vy1+t82.*vy1+t148.*vy1+t149.*vy1+t150.*vy1+t151.*vy1+t152.*vy1+t153.*vy1+t157.*vy1+t159.*vy1+t161.*vy1+t173.*vy1+t196.*vy1+t200.*vy1+t201.*vy1+d_psi1.*l12.*t70+d_psi1.*l12.*t71+d_psi1.*l13.*t72+d_psi1.*l13.*t73+d_psi1.*l12.*t174+d_psi1.*l13.*t175+d_psi1.*t2.*t47+d_psi1.*t2.*t48+d_psi1.*t2.*t143+d_psi1.*t53.*t147-delta11.*t80.*vx1+deltaPsi1.*t148.*vx1+deltaPsi1.*t149.*vx1+deltaPsi1.*t157.*vx1+deltaPsi1.*t159.*vx1+deltaPsi1.*t161.*vx1+deltaPsi1.*t196.*vx1+d_psi1.*m1.*t8.*t14+d_psi1.*m1.*t9.*t14+d_psi1.*m1.*t10.*t14+d_psi1.*m1.*t14.*t56+d_psi1.*m1.*t27.*t162+d_psi1.*m1.*t27.*t163+delta11.*t18.*t55.*vx1+delta11.*t19.*t55.*vx1+delta11.*t55.*t98.*vx1);d_psi1.*t225-deltaPsi1.*t210.*t221-d_deltaPsi1.*t54.*t210.*t224-t54.*t210.*t223.*vy1+Cy11.*delta11.*t210.*t213;d_psi1;d_deltaPsi1];
if nargout > 1
    A = reshape([0.0,0.0,0.0,0.0,0.0,0.0,0.0,-t54.*t210.*(t100+t106-t107-t108+t164+t165+J1.*t30+J1.*t31+J1.*t32+l1c1.*t80+l1c1.*t81+l1c1.*t82+l2c1.*t83+l2c1.*t85+l2c1.*t87+Cy11.*J1.*J2+Cy12.*J1.*J2+Cy13.*J1.*J2),t54.*t210.*(t70+t71+t72+t73-t80-t81-t82+t84+t86+t88+t147-t148-t149+t174+t175+t18.*t55+t19.*t55+t55.*t98),-t54.*t210.*t223,0.0,0.0,0.0,-t54.*t210.*(J1.*t33+J1.*t112+J1.*t113+J1.*t114+J1.*t115+J1.*t116+l11.*t100+l12.*t101+l13.*t102+l1c1.*t100+l2c1.*t107+l2c1.*t108+l1c1.*t164+l1c1.*t165+l2c1.*t169+t29.*t39+t29.*t40+t42.*t50+t43.*t50+t50.*t59+t50.*t60+t50.*t61+t50.*t117+t29.*t141+t29.*t142+J1.*J2.*t2-J1.*J2.*t3-J1.*J2.*t4-J1.*J2.*t8-J1.*J2.*t9-J1.*J2.*t10+l2c1.*t2.*t50+l2c1.*t3.*t120+l2c1.*t4.*t120),-t54.*t210.*(t100+t104+t105+t109+t110+t111+t164+t165+t179+t180-t182-t184-t185-t187+l12.*t70+l12.*t71+l13.*t72+l13.*t73+l12.*t174+l13.*t175+t2.*t47+t2.*t48+t2.*t143+t53.*t147+m1.*t8.*t14+m1.*t9.*t14+m1.*t10.*t14+m1.*t14.*t56+m1.*t27.*t162+m1.*t27.*t163),t225,1.0,0.0,0.0,J1.*t54.*t210.*t217,-l1c1.*m1.*t54.*t210.*t217,-t54.*t210.*t224,0.0,1.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,-J1.*t210.*t211,l1c1.*m1.*t210.*t211,-t210.*t221,0.0,0.0],[6,6]);
end
if nargout > 2
    B = reshape([0.0,Cy11.*t210.*(l11.*t49+l1c1.*t49+l2c1.*t50+J1.*J2),Cy11.*t210.*(t47+t48+t49+t143),Cy11.*t210.*t213,0.0,0.0,t121,0.0,0.0,0.0,0.0,0.0],[6,2]);
end
